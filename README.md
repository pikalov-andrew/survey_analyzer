# Survey Analyzer  
## Аннотация

Проект `survey_analyzer` предназначен для автоматизации валидации заполненных анкет
и генерации синтетических анкет, основанной на ассоциативных правилах между ответами и корреляции между вопросами, с последующим анализом качества сгенерированных данных.

## Содержание
- [Установка](#установка)
  - [1. Установите Git и Python](#1-установите-git-и-python-если-не-установлено)
  - [2. Клонируйте репозиторий](#2-клонируйте-репозиторий)
  - [3. Создайте виртуальное окружение](#3-создайте-виртуальное-окружение)
  - [4. Установите зависимости](#4-установите-зависимости)
- [Запуск проекта](#запуск-проекта)
  - [1. Подготовка данных](#1-подготовка-данных)
  - [2. Пример данных](#2-пример-данных)
  - [3. Файл конфигурации](#3-файл-конфигурации)
  - [4. Запуск программы](#4-запуск-программы)
- [Описание работы программы](#3-описание-работы-программы)  


## Установка
### 1. Установите Git и Python (если не установлено)
- **Git**: Скачайте и установите с [официального сайта](https://git-scm.com/ ).  
- **Python**: Скачайте и установите с [официального сайта](https://www.python.org/).

Если Python установлен, убедитесь что версия >3.9:
  ```bash  
  python --version
  ```
### 2. Клонируйте репозиторий
```bash  
    git clone https://github.com/pikalov-andrew/survey_analyzer.git   
    cd survey_analyzer 
```
### 3. Создайте виртуальное окружение
```bash  
python -m venv .venv  
source .venv/bin/activate  # Linux/macOS  
# или  
.venv\Scripts\activate     # Windows
```
### 4. Установите зависимости
```bash 
pip install -r requirements.txt  
```

## Запуск проекта
### 1. Подготовка данных

Программа предполагает наличие файла опросника, файлов ответов и файла с условиями проверки.
По умолчанию путь к файлам с данными `survey_analyzer/data`

#### 1. Создание опросника
Опросник представляет собой текстовый файл, содержащий вопросы, коды ответов и ответы.
Структура опросника предполагает следующий формат:

```
Номер_вопроса1. Вопрос1
код1 - ответ1
код2 - ответ2

номер_вопроса2. Вопрос2
код1 - ответ1
код2 - ответ2
код3 - ответ3
```
Коды ответов должны быть трехзначными цифрами. 
Коды с 1 по 99 они должны дополняться **нулями спереди**. Например, `001`.
Расширение файла по умолчанию - `.anc`.

#### 2. Создание файла ответов

Файл ответов представляет собой текстовый файл, содержащий коды ответов, разделенных запятыми.
Структура файла ответов предполагает следующий формат:

```
код1_анкеты1,код2_анкеты1,код3_анкеты1...кодN_анкеты1
код1_анкеты2,код2_анкеты2,код3_анкеты2...кодN_анкеты2
```

Ответы могут содержать текстовую информацию, 
при этом текст ответа должен быть записан **рядом с кодом ответа**. 
Например, `код1текст_ответа`. Расширения файла по умолчанию - `.opr` и `.txt`.

#### 3. Создание файла условий проверки ответов

Файл условий проверки ответов проверки представляет собой текстовый файл,
содержащий 4 поля, разделенных `#`: 
- В первом поле записано максимальное число ответов для каждого вопроса.
- Во втором поле указываются коды ответов, которые исключают 
возможность выбора других кодов ответов и исключающиеся коды ответов.
- В третьем поле указываются коды ответов, предполагающих наличие
других кодов ответов и требуемые коды ответов.
- В четвертом поле записано минимальное число ответов для каждого вопроса.

Пример файла условий проверки ответов:
```
1.2.1.3#                     --Максимальное число ответов для вопросов: 1 - 1, 2 - 2, 3 - 1, 4 - 3
001:010,011/002:011,022#     --Код 001 исключает ответы 010 и 011, код 002 - 011 и 022
002:010#                     --Код 002 предполагает наличие ответа 010
1.0.0.1#                     --Минимальное число ответов для вопросов: 1 - 1, 2 - 0, 3 - 0, 4 - 1
```

При отсутствии или некоректности файла условий проверки будет предложено
использовать файл с условиями по умолчанию, в котором нет исключающих и 
предполагающих кодов, а максимальное и минимальное число ответов для 
каждого вопроса будет 1. Расширения файла по умолчанию - `.cnf`.

### 2. Пример данных

В папке `survey_analyzer/data/examples` находится архив `examples.rar` с примером данных.

### 3. Файл конфигурации

Файл конфигурации имеет следующие параметры:

*   "ignored_codes" - игнорируемые коды, которые не будут учитываться при проверке. Также добавляются в сгенерированные анкеты.
*   "needed_answers_count" - общее число анкет. Количество сгенерированных будет равно этому числу за вычитом имеющихся в файлах ответов.
*   "static_error" - статистическая ошибка, включаемая в функции для расчета вероятностей.
*   "strong_pairs_coefficient" - пороговое значение коэффициента корреляции между вопросами.
*   "data_dir" - название папки с данными.
*   "question_data_ext" - расширение файла опросника.
*   "answer_data_ext" - расширение файлов с ответами.
*   "conditions_ext" - расширение файла с условиями проверки.
*   "may_repeat" - параметр, определяющий, могут ли строки ответов полностью повторяться.

При отсутствии файла конфигурации - он будет создан с параметрами по умолчанию.

### 4. Запуск программы

Для запуска программы выполните комманду: 

```bash
python run.py
```

## 3. Описание работы программы

1. Подготовка:
   * Программа начинает работу с чтения настроек из конфигурационного файла. Здесь определены требования к анкетам: минимальное и максимальное количество ответов, запрещённые коды, путь к данным и другие параметры. Если конфигурации нет, программа создаёт шаблон с базовыми настройками.
2. Сбор данных:
   * Программа считывает информацию из трёх источников:
     * Файл опросника — содержит тексты вопросов и допустимые варианты ответов.
     * Файлы ответов — данные, собранные от респондентов.
     * Файл условий — правила, которым должны соответствовать анкеты. Если условия отсутствуют, используются стандартные настройки.
3. Проверка и исправление анкет:
   * Все загруженные анкеты проверяются на соответствие заданным правилам:
     * Дубликаты: Если анкеты повторяются, они удаляются (если это разрешено настройками).
     * Логические ошибки: Программа ищет противоречия (например, запрещённые комбинации ответов) и недостающие обязательные поля.
     * Количество ответов: Проверяется, чтобы в каждом вопросе было не меньше и не больше допустимого числа ответов.
     * Если находятся ошибки, программа автоматически исправляет их: удаляет некорректные ответы, добавляет недостающие или корректирует количество.
4. Генерация новых анкет:
   * Если после проверки анкет меньше нужного количества, программа создает новые данные. Для этого:
     * Группировка похожих анкет: Существующие анкеты разбиваются на кластеры по схожести.
     * Анализ связей: Выявляются зависимости между вопросами и ассоциативный правила ответов для каждого кластера.
     * Создание новых анкет: Новые данные формируются так, чтобы повторять статистику исходных анкет и соблюдать логические правила внутри одного кластера.
5. Добавление открытых вопросов:
   * К анкетам добавляются пометки для открытых вопросов, чтобы в дальнейшем пользователь мог вручную заполнить эти поля.
6. Сохранение результатов:
   * Для каждого кластера сохраняются таблицы пар вопросов с высокой корреляцией и ассоциативные правила.
   * Готовые анкеты сохраняются в папку с отчётами. Если возникают ошибки (например, проблема с кодировкой), программа предлагает альтернативные способы сохранения.
7. Оценка качества:
   * Программа сравнивает исходные и сгенерированные данные, чтобы убедиться, что новые анкеты соответствуют статистическим закономерностям и правилам.

* Что получается в итоге?
  * На выходе вы получаете набор анкет, который:
    * Соответствует заданным правилам.
    * Повторяет структуру и логику реальных данных.
    * Готов к использованию в исследованиях или тестировании.
* Преимущества подхода основаны на:
  * Точности. Сохранение статистических зависимостей между вопросами и ответами.
  * Автоматизации. Всё делается без ручной настройки — достаточно указать требования.
  * Гибкости. Можно менять правила и параметры, не переписывая код.
  * Качества. Все действия логируются, ошибки исправляются автоматически.
* Программа подходит для:
  * Тестирования систем обработки анкет.
  * Генерации синтетических данных для исследований.
  * Исправления ошибок в уже собранных данных.
